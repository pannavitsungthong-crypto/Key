--[[  
    WARNING: Heads up! This script has not been verified by ScriptBlox. Use at your own risk!  
]]  

local Players = game:GetService("Players")  
local RunService = game:GetService("RunService")  

local player = Players.LocalPlayer  
local camera = workspace.CurrentCamera  
local playerGui = player:WaitForChild("PlayerGui")  

--========================
-- GUI
--========================
local screenGui = Instance.new("ScreenGui")  
screenGui.Name = "LockOnGui"  
screenGui.ResetOnSpawn = false -- ⭐ ทำให้ไม่หายตอนตาย  
screenGui.Parent = playerGui  

local button = Instance.new("TextButton")  
button.Name = "LockOnButton"  
button.Size = UDim2.new(0, 35, 0, 35)  
button.Position = UDim2.new(0, 605, 0, -40)  
button.Text = "Lock On"  
button.TextScaled = true  
button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)  
button.TextColor3 = Color3.fromRGB(255, 255, 255)  
button.BackgroundTransparency = 0.4  
button.Parent = screenGui  

-- Glow
local glowFrame = Instance.new("Frame")  
glowFrame.Size = UDim2.new(1.2, 0, 1.2, 0)  
glowFrame.Position = UDim2.new(0, -5, 0, -5)  
glowFrame.BackgroundTransparency = 1  
glowFrame.BackgroundColor3 = Color3.fromRGB(0, 255, 0)  
glowFrame.Visible = false  
glowFrame.Parent = button  

local glowGradient = Instance.new("UIGradient")  
glowGradient.Color = ColorSequence.new(Color3.fromRGB(0, 255, 0), Color3.fromRGB(0, 255, 0))  
glowGradient.Transparency = NumberSequence.new(0.5, 1)  
glowGradient.Rotation = 45  
glowGradient.Parent = glowFrame  

--========================
-- STATE
--========================
local isLockedOn = false  
local target = nil  

--========================
-- TARGET FIND
--========================
local function getNearestTarget()  
    local char = player.Character  
    if not char then return nil end  

    local root = char:FindFirstChild("HumanoidRootPart")  
    if not root then return nil end  

    local nearest = nil  
    local shortestDistance = 50  

    for _, obj in ipairs(workspace:GetDescendants()) do  
        if obj:IsA("Model")  
        and obj ~= char  
        and obj:FindFirstChild("Humanoid")  
        and obj:FindFirstChild("HumanoidRootPart")  
        and obj.Humanoid.Health > 0 then  

            local distance = (obj.HumanoidRootPart.Position - root.Position).Magnitude  
            if distance < shortestDistance then  
                shortestDistance = distance  
                nearest = obj  
            end  
        end  
    end  

    return nearest  
end  

--========================
-- BUTTON TOGGLE
--========================
button.MouseButton1Click:Connect(function()  
    isLockedOn = not isLockedOn  

    if isLockedOn then  
        button.BackgroundColor3 = Color3.fromRGB(102, 255, 102)  
        glowFrame.Visible = true  

        if not target then  
            target = getNearestTarget()  
        end  
    else  
        button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)  
        glowFrame.Visible = false  

        local char = player.Character  
        if char and char:FindFirstChild("Humanoid") then  
            camera.CameraSubject = char.Humanoid  
        end  

        target = nil  
    end  
end)  

--========================
-- CHARACTER RESPAWN FIX
--========================
player.CharacterAdded:Connect(function(char)  
    local humanoid = char:WaitForChild("Humanoid")  
    camera.CameraSubject = humanoid  

    -- ถ้า Lock เปิดอยู่ → หาเป้าใหม่อัตโนมัติ
    if isLockedOn then  
        target = getNearestTarget()  

        if not target then  
            isLockedOn = false  
            button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)  
            glowFrame.Visible = false  
        end  
    end  
end)  

--========================
-- CAMERA LOCK
--========================
RunService.RenderStepped:Connect(function()  
    if not isLockedOn then return end  
    if not target then return end  

    local humanoidRootPart = target:FindFirstChild("HumanoidRootPart")  
    local humanoid = target:FindFirstChild("Humanoid")  

    if humanoidRootPart and humanoid and humanoid.Health > 0 then  
        local cameraPosition = camera.CFrame.Position  
        local direction = (humanoidRootPart.Position - cameraPosition).Unit  
        camera.CFrame = CFrame.new(cameraPosition, cameraPosition + direction)  
    else  
        -- เป้าหาย / ตาย
        isLockedOn = false  
        target = nil  
        glowFrame.Visible = false  
        button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)  

        local char = player.Character  
        if char and char:FindFirstChild("Humanoid") then  
            camera.CameraSubject = char.Humanoid  
        end  
    end  
end)
